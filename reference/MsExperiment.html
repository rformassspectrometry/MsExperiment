<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Managing Mass Spectrometry Experiments — experimentFiles • MsExperiment</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Managing Mass Spectrometry Experiments — experimentFiles"><meta name="description" content="The MsExperiment class allows the storage and management of all
aspects related to a complete proteomics or metabolomics mass
spectrometry experiment. This includes experimantal design (i.e. a table
with samples), raw mass spectromtry data as spectra and chromatograms,
quantitative features, and identification data or any other relevant data
files.
For details, see https://rformassspectrometry.github.io/MsExperiment
This package is part of the RforMassSpectrometry initiative:
https://www.rformassspectrometry.org/"><meta property="og:description" content="The MsExperiment class allows the storage and management of all
aspects related to a complete proteomics or metabolomics mass
spectrometry experiment. This includes experimantal design (i.e. a table
with samples), raw mass spectromtry data as spectra and chromatograms,
quantitative features, and identification data or any other relevant data
files.
For details, see https://rformassspectrometry.github.io/MsExperiment
This package is part of the RforMassSpectrometry initiative:
https://www.rformassspectrometry.org/"><meta property="og:image" content="https://rformassspectrometry.github.io/MsExperiment/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MsExperiment</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.11.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MsExperiment.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/MsExperiment/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Managing Mass Spectrometry Experiments</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/MsExperiment/blob/main/R/MsExperiment-functions.R" class="external-link"><code>R/MsExperiment-functions.R</code></a>, <a href="https://github.com/RforMassSpectrometry/MsExperiment/blob/main/R/MsExperiment.R" class="external-link"><code>R/MsExperiment.R</code></a></small>
      <div class="d-none name"><code>MsExperiment.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>MsExperiment</code> class allows the storage and management of all
aspects related to a complete proteomics or metabolomics mass
spectrometry experiment. This includes experimantal design (i.e. a table
with samples), raw mass spectromtry data as spectra and chromatograms,
quantitative features, and identification data or any other relevant data
files.</p>
<p>For details, see https://rformassspectrometry.github.io/MsExperiment</p>
<p>This package is part of the RforMassSpectrometry initiative:
https://www.rformassspectrometry.org/</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">experimentFiles</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">experimentFiles</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="fu">sampleData</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sampleData</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="fu">qdata</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">qdata</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="fu">spectraSampleIndex</span><span class="op">(</span><span class="va">x</span>, duplicates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"first"</span>, <span class="st">"keep"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">MsExperiment</span><span class="op">(</span></span>
<span>  experimentFiles <span class="op">=</span> <span class="fu"><a href="MsExperimentFiles.html">MsExperimentFiles</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  otherData <span class="op">=</span> <span class="fu">List</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  qdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sampleData <span class="op">=</span> <span class="fu">DataFrame</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  spectra <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MsExperiment'</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MsExperiment'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MsExperiment'</span></span>
<span><span class="fu">spectra</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MsExperiment'</span></span>
<span><span class="fu">spectra</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="fu">otherData</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">otherData</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="fu">linkSampleData</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  with <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  sampleIndex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu">sampleData</span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  withIndex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  subsetBy <span class="op">=</span> <span class="fl">1L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MsExperiment,ANY,ANY,ANY'</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span>, <span class="va">...</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># S4 method for class 'MsExperiment,function'</span></span>
<span><span class="fu">filterSpectra</span><span class="op">(</span><span class="va">object</span>, <span class="va">filter</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An instance of class <code>MsExperiment</code>.</p></dd>


<dt id="arg-value">value<a class="anchor" aria-label="anchor" href="#arg-value"></a></dt>
<dd><p>An object of the appropriate class for the slot to be
populated.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>an <code>MsExperiment</code>.</p></dd>


<dt id="arg-duplicates">duplicates<a class="anchor" aria-label="anchor" href="#arg-duplicates"></a></dt>
<dd><p>for <code>spectraSampleIndex()</code>: <code>character(1)</code> defining the
type of result returned by <code>spectraSampleIndex()</code>. With
<code>duplicates = "first"</code> an <code>integer</code> vector is returned with the first
match while <code>duplicates = "keep"</code> returns a <code>list</code> of <code>integer</code> with
the index of all matches.</p></dd>


<dt id="arg-experimentfiles">experimentFiles<a class="anchor" aria-label="anchor" href="#arg-experimentfiles"></a></dt>
<dd><p><code><a href="MsExperimentFiles.html">MsExperimentFiles()</a></code> defining (external) files
to data or annotation.</p></dd>


<dt id="arg-otherdata">otherData<a class="anchor" aria-label="anchor" href="#arg-otherdata"></a></dt>
<dd><p><code>List</code> with arbitrary additional (<em>other</em>) information or
data.</p></dd>


<dt id="arg-qdata">qdata<a class="anchor" aria-label="anchor" href="#arg-qdata"></a></dt>
<dd><p><code>QFeatures</code> or <code>SummarizedExperiment</code> with the quantification
data.</p></dd>


<dt id="arg-sampledata">sampleData<a class="anchor" aria-label="anchor" href="#arg-sampledata"></a></dt>
<dd><p><code>DataFrame</code> (or <code>data.frame</code>) with information on
individual samples of the experiment.</p></dd>


<dt id="arg-spectra">spectra<a class="anchor" aria-label="anchor" href="#arg-spectra"></a></dt>
<dd><p><code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> object with the MS spectra data of the
experiment.</p></dd>


<dt id="arg-with">with<a class="anchor" aria-label="anchor" href="#arg-with"></a></dt>
<dd><p>for <code>linkSampleData()</code>: <code>character(1)</code> defining the data to which
samples should be linked. See section <em>Linking sample data to other
experimental data</em> for details.</p></dd>


<dt id="arg-sampleindex">sampleIndex<a class="anchor" aria-label="anchor" href="#arg-sampleindex"></a></dt>
<dd><p>for <code>linkSampleData()</code>: <code>integer</code> with the indices of the
samples in <code>sampleData(object)</code> that should be linked.</p></dd>


<dt id="arg-withindex">withIndex<a class="anchor" aria-label="anchor" href="#arg-withindex"></a></dt>
<dd><p>for <code>linkSampleData()</code>: <code>integer</code> with the indices of the
elements in <code>with</code> to which the samples (specified by <code>sampleIndex</code>)
should be linked to.</p></dd>


<dt id="arg-subsetby">subsetBy<a class="anchor" aria-label="anchor" href="#arg-subsetby"></a></dt>
<dd><p>for <code>linkSampleData()</code>: optional <code>integer(1)</code> defining the
dimension on which the subsetting will occurr on the linked data.
Defaults to <code>subsetBy = 1L</code> thus subsetting will happen on the first
dimension (rows or elements).</p></dd>


<dt id="arg-i">i<a class="anchor" aria-label="anchor" href="#arg-i"></a></dt>
<dd><p>for <code>[</code>: an <code>integer</code>, <code>character</code> or <code>logical</code> referring to the
indices or names (rowname of <code>sampleData</code>) of the samples to subset.</p></dd>


<dt id="arg-j">j<a class="anchor" aria-label="anchor" href="#arg-j"></a></dt>
<dd><p>for <code>[</code>: not supported.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>optional additional parameters. For <code>filterSpectra()</code>: parameters
to be passed to the filter function (parameter <code>filter</code>).</p></dd>


<dt id="arg-drop">drop<a class="anchor" aria-label="anchor" href="#arg-drop"></a></dt>
<dd><p>for <code>[</code>: ignored.</p></dd>


<dt id="arg-filter">filter<a class="anchor" aria-label="anchor" href="#arg-filter"></a></dt>
<dd><p>for <code>filterSpectra()</code>: any filter function supported by
<code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> to filter the spectra object (such as <code>filterRt</code> or
<code>filterMsLevel</code>). Parameters for the filter function can be passed
through <code>...</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>See help of the individual functions.</p>
    </div>
    <div class="section level2">
    <h2 id="slots">Slots<a class="anchor" aria-label="anchor" href="#slots"></a></h2>


<dl><dt><code>experimentFiles</code></dt>
<dd><p>An instance of class <code>MsExperimentFiles</code> or <code>NULL</code>.</p></dd>


<dt><code>spectra</code></dt>
<dd><p>An instance of class <code>Spectra</code> or <code>NULL</code>.</p></dd>


<dt><code>qdata</code></dt>
<dd><p>An instance of class <code>QFeatures</code>, <code>SummarizedExperiment</code> or
<code>NULL</code>.</p></dd>


<dt><code>otherData</code></dt>
<dd><p>A <code>List</code> to store any additional data objects.</p></dd>


<dt><code>sampleData</code></dt>
<dd><p>A <code>DataFrame</code> documenting the experimental design.</p></dd>


<dt><code>sampleDataLinks</code></dt>
<dd><p>A <code>List</code> with link definitions between samples and
data elements. Should not be directly accessed or modified by the user.</p></dd>


<dt><code>metadata</code></dt>
<dd><p>A <code>list</code> to store additional metadata.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="general-information">General information<a class="anchor" aria-label="anchor" href="#general-information"></a></h2>



<p>An experiment is typically composed of several items</p><ul><li><p>Description and information (covariates etc) of each sample from
the experiment. These are stored in the <code>sampleData</code> slot as a
<code>DataFrame</code>, each row describing a sample with columns containing
all relevant information on that sample.</p></li>
<li><p>Files to data or annotations. These are stored in the
<code>@experimentFiles</code> slot as an instance of class <code>MsExperimentFiles</code>.</p></li>
<li><p>General metadata about the experiment, stored as a <code>list</code> in the
<code>@metadata</code> slot.</p></li>
<li><p>Mass spectrometry data. Sectra and their metadata are stored as
an <code>[Spectra::Spectra()]</code> object in the <code>spectra</code> slot. Chromatographic
data is not yet supported but will be stored as a <code>Chromatograms()</code>
object in the <code>@chromatorgrams</code> slot.</p></li>
<li><p>Quantification data is stored as <code>QFeatures</code> or
<code>SummarizedExperiment</code> objects in the <code>@qdata</code> slot and can be accessed or
replaced with the <code>qdata()</code> or <code>qdata&lt;-</code> functions, respectively.</p></li>
<li><p>Any additional data, be it other spectra data, or proteomics
identification data (i.e peptide-spectrum matches defined as
<code>PSM</code> objects) can be added as elements to the list stored in
the <code>otherData</code> slot.</p></li>
</ul><p>The <em>length</em> of a <code>MsExperiment</code> is defined by the number of samples (i.e.
the number of rows of the object's <code>sampleData</code>). A <code>MsExperiment</code> with two
samples will thus have a length of two, independently of the number of files
or length of raw data in the object. This also defines the subsetting of the
object using the <code>[</code> function which will always subset by samples. See the
section for filtering and subsetting below for more information.</p>
<p><code>MsExperiment</code> objects can be created using the <code>MsExperiment()</code> function
providing the data with the parameters listed below. If the
<code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code>
object provided with the <code>spectra</code> param uses a <code>MsBackendSql</code> backend,
sample data could be retrieved from the associated SQL database (see
section <em>Using <code>MsExperiment</code> with <code>MsBackendSql</code></em> in the vignette for
details). Alternatively, it is also possible to subsequently add data and
information to an existing <code>MsExperiment</code>.
Finally, with the <code><a href="readMsExperiment.html">readMsExperiment()</a></code> function it is possible to create
a <code>MsExperiment</code> by importing MS spectra data directly from provided data
files. See examples below or the package vignette for more information.</p>
    </div>
    <div class="section level2">
    <h2 id="accessing-data">Accessing data<a class="anchor" aria-label="anchor" href="#accessing-data"></a></h2>



<p>Data from an <code>MsExperiment</code> object can be accessed with the dedicated
accessor functions:</p><ul><li><p><code>experimentFiles()</code>, <code>experimentFiles&lt;-</code>: gets or sets experiment files.</p></li>
<li><p><code><a href="https://rdrr.io/r/base/length.html" class="external-link">length()</a></code>: get the <em>length</em> of the object which represents the number of
samples availble in the object's <code>sampleData</code>.</p></li>
<li><p><code><a href="https://rdrr.io/pkg/S4Vectors/man/Annotated-class.html" class="external-link">metadata()</a></code>, <code>metadata&lt;-</code>: gets or sets the object's metadata.</p></li>
<li><p><code>sampleData()</code>, <code>sampleData&lt;-</code>: gets or sets the object's sample data
(i.e. a <code>DataFrame</code> containing sample descriptions).</p></li>
<li><p><code>spectra()</code>, <code>spectra&lt;-</code>: gets or sets spectra data. <code>spectra()</code> returns a
<code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> object, <code>spectra&lt;-</code> takes a <code>Spectra</code> data as input
and returns the updated <code>MsExperiment</code>.</p></li>
<li><p><code>spectraSampleIndex()</code>: depending on parameter <code>duplicates</code> it returns
either an <code>integer</code> (<code>duplicates = "first"</code>, the default) or a <code>list</code>
(<code>duplicates = "keep"</code>) of length equal to the number of spectra within
the object with the indices of the sample(s) (in <code>sampleData()</code>) a
spectrum is assigned to. With <code>duplicates = "first"</code>, an <code>integer</code> with
the index is returned for each spectrum. If a spectrum was assigned to
more than one sample a warning is shown and only the first sample index
is returned for that spectrum. For <code>duplicates = "keep"</code>, assignments are
returned as a <code>list</code> of <code>integer</code> vectors, each element being the
index(es) of the sample(s) a spectrum is assigned to. For spectra that are
not linked to any sample an <code>NA_integer_</code> is returned as index for
<code>duplicates = "first"</code> and an empty integer (<code><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer()</a></code>) for
<code>duplicates = "keep"</code>.
Note that the default <code>duplicates = "first"</code> will work in almost all use
cases, as generally, a spectrum will be assigned to a single sample.</p></li>
<li><p><code>qdata()</code>, <code>qdata&lt;-</code>: gets or sets the quantification data, which can be a
<code>QFeatures</code> or <code>SummarizedExperiment</code>.</p></li>
<li><p><code>otherData()</code> , <code>otherData&lt;-</code>: gets or sets the addition data
types, stored as a <code>List</code> in the object's <code>otherData</code> slot.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="linking-sample-data-to-other-experimental-data">Linking sample data to other experimental data<a class="anchor" aria-label="anchor" href="#linking-sample-data-to-other-experimental-data"></a></h2>



<p>To start with, an <code>MsExperiment</code> is just a loose collection of files and data
related to an experiment, no explicit links or associactions are present
between the samples and related data. Such links can however be created with
the <code>linkSampleData()</code> function. This function can establish links between
individual (or all) samples within the object's <code>sampleData</code> to individual,
or multiple, data elements or files, such as <code>Spectra</code> or raw data files.</p>
<p>The presence of such links enables a (consistent) subsetting of an
<code>MsExperiment</code> by samples. Thus, once the link is defined, any subsetting by
sample will also correctly subset the linked data. All other, not linked,
data elements are always retained as in the original <code>MsExperiment</code>.</p>
<p>To be able to link different elements within an <code>MsExperiment</code> it is also
required to <em>identify</em> them with a consistent naming scheme. The naming
scheme of slots and data elements within follows an SQL-like scheme, in which
the variable (element) is identified by the name of the database table,
followed by a <code>"."</code> and the name of the database table column. For
<code>MsExperiment</code>, the naming scheme is defined as
<code>"&lt;slot name&gt;.&lt;element name&gt;"</code>. A column called <code>"sample_name"</code> within the
<code>sampleData</code> data frame can thus be addressed with
<code>"sampleData.sample_name"</code>, while <code>spectra.msLevel</code> would represent the
spectra variable called <code>msLevel</code> within the <code>Spectra</code> stored in the
<code>spectra</code> slot.</p>
<p>Links between sample data rows and any other data element are stored as
<code>integer</code> matrices within the <code>@sampleDataLinks</code> slot of the object (see also
the vignette for examples and illustrations). The first column of a matrix
is always the index of the sample, and the second column the index of the
element that is linked to that sample, with one row per element.
Links can be defined/added with the <code>linkSampleData()</code> function which adds
a relationship between rows in <code>sampleData</code> to elements in any other data
within the <code>MsExperiment</code> that are specified with parameter <code>with</code>.
<code>linkSampleData()</code> supports two different ways to define the link:</p><ul><li><p>Parameter <code>with</code> defines the data to which the link should be established.
To link samples to raw data files that would for example be available as a
<code>character</code> in an element called <code>"raw_files"</code> within the object's
<code>experimentFiles</code>, <code>with = experimentFiles.raw_files</code> would have to be
used. Next it is required to specify which samples should be linked with
which elements in <code>with</code>. This needs to be defined with the parameters
<code>sampleIndex</code> and <code>withIndex</code>, both are expected to be <code>integer</code> vectors
specifying which sample in <code>sampleData</code> should be linked to which element
in <code>with</code> (see examples below or vignette for examples and details).</p></li>
<li><p>As an alternative way, a link could be defined with an SQL-like syntax
that relates a column in <code>sampleData</code> to a column/element in the data to
which the link should be established. To link for example individual
spectra to the corresponding samples
<code>with = "sampleData.raw_file = spectra.dataOrigin"</code> could be used assuming
that <code>sampleData</code> contains a column named <code>"raw_file"</code> with the (full path)
of the raw data file for each sample from which the spectra were imported.
In this case both <code>sampleIndex</code> and <code>withIndex</code> can be omitted, but it is
expected/required that the columns/elements from <code>sampleData</code> and the data
element to which the link should be established contain matching values.</p></li>
</ul><p>Note that <code>linkSampleData</code> will <strong>replace</strong> a previously existing link to the
same data element.</p><ul><li><p><code>spectraSampleIndex()</code> is a convenience function that extracts for each
spectrum in the object's <code>spectra()</code> the index of the sample it is
associated with (see function's help above for more information).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="subsetting-and-filtering">Subsetting and filtering<a class="anchor" aria-label="anchor" href="#subsetting-and-filtering"></a></h2>


<ul><li><p><code>[</code>: <code>MsExperiment</code> objects can be subset <strong>by samples</strong> with <code>[i]</code>
where <code>i</code> is the index or a logical defining to which samples the data
should be subset. Subsetting by sample will (correctly) subset all
linked data to the respective samples. If multiple samples are linked to
the same data element, subsetting might duplicate that data element. This
duplication of <em>n:m</em> relationships between samples to elements does however
not affect data consistency (see examples below for more information).
Not linked data (slots) will be returned as they are. Subsetting in
arbitrary order is supported.
See the vignette for details and examples.</p></li>
<li><p><code>filterSpectra()</code>: subsets the <code>Spectra</code> within an <code>MsExperiment</code> using a
provided filter function (parameter <code>filter</code>). Parameters for the filter
function can be passed with parameter <code>...</code>. Any of the filter functions
of a <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> object can be passed with parameter <code>filter</code>.
Possibly present relationships between samples and spectra (<em>links</em>, see
also <code>linkSampleData()</code>) are updated. Filtering affects only the spectra
data of the object, none of the other slots and data (e.g. <code>sampleData</code>)
are modified.
The function returns an <code>MsExperiment</code> with the filtered <code>Spectra</code> object.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Laurent Gatto, Johannes Rainer</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## An empty MsExperiment object</span></span></span>
<span class="r-in"><span><span class="va">msexp</span> <span class="op">&lt;-</span> <span class="fu">MsExperiment</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">msexp</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Empty object of class MsExperiment </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/example.html" class="external-link">example</a></span><span class="op">(</span><span class="va">MsExperimentFiles</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF&gt; fls &lt;- MsExperimentFiles(mzmls = c("/path/to/f1.mzML", "/path/to/f2.mzML"),</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF+                          mzids = "/another/path/to/id1.mzid",</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF+                          fasta = "file.fas")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF&gt; fls</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExperimentFiles of length  3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [["mzmls"]] f1.mzML f2.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [["mzids"]] id1.mzid</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [["fasta"]] file.fas</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF&gt; ## A new MsExperimentFiles containing mzML or mzid files</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF&gt; fls[1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExperimentFiles of length  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [["mzmls"]] f1.mzML f2.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF&gt; fls["mzids"]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExperimentFiles of length  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [["mzids"]] id1.mzid</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF&gt; ## The actual file names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF&gt; fls[[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/path/to/f1.mzML" "/path/to/f2.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF&gt; fls[[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/another/path/to/id1.mzid"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF&gt; fls[["fasta"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "file.fas"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF&gt; ## None of the files used in this example actually exist</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MsExpF&gt; existMsExperimentFiles(fls)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> mzmls: 0 out of 2 exist(s)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> mzids: 0 out of 1 exist(s)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> fasta: 0 out of 1 exist(s)</span>
<span class="r-in"><span><span class="fu">experimentFiles</span><span class="op">(</span><span class="va">msexp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">fls</span></span></span>
<span class="r-in"><span><span class="va">msexp</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class MsExperiment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Files: mzmls, mzids, fasta </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Linking samples to data elements</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a small experiment</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/S4Vectors" class="external-link">S4Vectors</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: stats4</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: BiocGenerics</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: generics</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘generics’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     as.difftime, as.factor, as.ordered, intersect, is.element, setdiff,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     setequal, union</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘BiocGenerics’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     IQR, mad, sd, var, xtabs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Filter, Find, Map, Position, Reduce, anyDuplicated, aperm, append,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     as.data.frame, basename, cbind, colnames, dirname, do.call,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     duplicated, eval, evalq, get, grep, grepl, is.unsorted, lapply,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     mapply, match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     rank, rbind, rownames, sapply, saveRDS, table, tapply, unique,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     unsplit, which.max, which.min</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘S4Vectors’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:utils’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     findMatches</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     I, expand.grid, unname</span>
<span class="r-in"><span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu">MsExperiment</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span>sample_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"QC1"</span>, <span class="st">"QC2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                sample_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"QC Pool"</span>, <span class="st">"QC Pool"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                injection_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">sampleData</span><span class="op">(</span><span class="va">mse</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">sd</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## define file names containing spectra data for the samples and</span></span></span>
<span class="r-in"><span><span class="co">## add them, along with other arbitrary files to the experiment</span></span></span>
<span class="r-in"><span><span class="va">fls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sciex"</span>, package <span class="op">=</span> <span class="st">"msdata"</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">experimentFiles</span><span class="op">(</span><span class="va">mse</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="MsExperimentFiles.html">MsExperimentFiles</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    mzML_files <span class="op">=</span> <span class="va">fls</span>,</span></span>
<span class="r-in"><span>    annotations <span class="op">=</span> <span class="st">"internal_standards.txt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Link samples to data files: first sample to first file in "mzML_files",</span></span></span>
<span class="r-in"><span><span class="co">## second sample to second file in "mzML_files"</span></span></span>
<span class="r-in"><span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu">linkSampleData</span><span class="op">(</span><span class="va">mse</span>, with <span class="op">=</span> <span class="st">"experimentFiles.mzML_files"</span>,</span></span>
<span class="r-in"><span>    sampleIndex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, withIndex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Link all samples to the one file in "annotations"</span></span></span>
<span class="r-in"><span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu">linkSampleData</span><span class="op">(</span><span class="va">mse</span>, with <span class="op">=</span> <span class="st">"experimentFiles.annotations"</span>,</span></span>
<span class="r-in"><span>    sampleIndex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, withIndex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mse</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class MsExperiment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Files: mzML_files, annotations </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Experiment data: 2 sample(s)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Sample data links:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - experimentFiles.mzML_files: 2 sample(s) to 2 element(s).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - experimentFiles.annotations: 2 sample(s) to 1 element(s).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Import the spectra data and add it to the experiment</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/Spectra" class="external-link">Spectra</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: BiocParallel</span>
<span class="r-in"><span><span class="fu">spectra</span><span class="op">(</span><span class="va">mse</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">fls</span>, backend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/MsBackend.html" class="external-link">MsBackendMzR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Link each spectrum to the respective sample. We use the alternative</span></span></span>
<span class="r-in"><span><span class="co">## link definition that does not require sampleIndex and withIndex but</span></span></span>
<span class="r-in"><span><span class="co">## links elements based on matching values in the specified data elements.</span></span></span>
<span class="r-in"><span><span class="co">## We need to add the full file name as an additional column to sampleData</span></span></span>
<span class="r-in"><span><span class="co">## in order to allow matching this file names with the value in</span></span></span>
<span class="r-in"><span><span class="co">## spectra(mse)$dataOrigin which contains the original file names from which</span></span></span>
<span class="r-in"><span><span class="co">## the spectra were imported.</span></span></span>
<span class="r-in"><span><span class="fu">sampleData</span><span class="op">(</span><span class="va">mse</span><span class="op">)</span><span class="op">$</span><span class="va">raw_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="va">fls</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The links can be added using the short notation below</span></span></span>
<span class="r-in"><span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu">linkSampleData</span><span class="op">(</span><span class="va">mse</span>, with <span class="op">=</span> <span class="st">"sampleData.raw_file = spectra.dataOrigin"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mse</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class MsExperiment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Files: mzML_files, annotations </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Spectra: MS1 (1862) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Experiment data: 2 sample(s)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Sample data links:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - experimentFiles.mzML_files: 2 sample(s) to 2 element(s).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - experimentFiles.annotations: 2 sample(s) to 1 element(s).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - spectra: 2 sample(s) to 1862 element(s).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With sampleData links present, any subsetting of the experiment by sample</span></span></span>
<span class="r-in"><span><span class="co">## will ensure that all linked elements are subset accordingly</span></span></span>
<span class="r-in"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">mse</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">b</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class MsExperiment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Files: mzML_files, annotations </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Spectra: MS1 (931) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Experiment data: 1 sample(s)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Sample data links:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - experimentFiles.mzML_files: 1 sample(s) to 1 element(s).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - experimentFiles.annotations: 1 sample(s) to 1 element(s).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - spectra: 1 sample(s) to 931 element(s).</span>
<span class="r-in"><span><span class="fu">sampleData</span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 1 row and 4 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     sample_id sample_name injection_idx      raw_file</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;character&gt; &lt;character&gt;     &lt;numeric&gt;   &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         QC2     QC Pool             3 /__w/_temp...</span>
<span class="r-in"><span><span class="fu">experimentFiles</span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">mzML_files</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_3_105-134.mzML"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The `spectraSampleIndex()` function returns, for each spectrum, the</span></span></span>
<span class="r-in"><span><span class="co">## index in the object's `sampleData` to which it is linked/assigned</span></span></span>
<span class="r-in"><span><span class="fu">spectraSampleIndex</span><span class="op">(</span><span class="va">mse</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [75] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [112] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [149] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [186] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [223] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [260] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [297] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [334] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [371] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [408] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [445] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [482] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [519] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [556] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [593] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [630] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [667] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [704] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [741] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [778] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [815] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [852] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [889] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [926] 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [963] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1000] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1037] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1074] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1111] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1148] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1185] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1222] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1259] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1296] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1333] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1370] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1407] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1444] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1481] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1518] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1555] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1592] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1629] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1666] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1703] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1740] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1777] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1814] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1851] 2 2 2 2 2 2 2 2 2 2 2 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Subsetting with duplication of n:m sample to data relationships</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## Both samples were assigned above to one "annotation" file in</span></span></span>
<span class="r-in"><span><span class="co">## `experimentFiles`:</span></span></span>
<span class="r-in"><span><span class="fu">experimentFiles</span><span class="op">(</span><span class="va">mse</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">[[</span><span class="st">"annotations"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "internal_standards.txt"</span>
<span class="r-in"><span><span class="fu">experimentFiles</span><span class="op">(</span><span class="va">mse</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">[[</span><span class="st">"annotations"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "internal_standards.txt"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Subsetting will always keep the relationship between samples and linked</span></span></span>
<span class="r-in"><span><span class="co">## data elements. Subsetting will however possibly duplicate data elements</span></span></span>
<span class="r-in"><span><span class="co">## that are shared among samples. Thus, while in the original object the</span></span></span>
<span class="r-in"><span><span class="co">## element "annotations" has a single entry, subsetting with [1:2] will</span></span></span>
<span class="r-in"><span><span class="co">## result in an MsExperiment with duplicated entries in "annotations"</span></span></span>
<span class="r-in"><span><span class="fu">experimentFiles</span><span class="op">(</span><span class="va">mse</span><span class="op">)</span><span class="op">[[</span><span class="st">"annotations"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "internal_standards.txt"</span>
<span class="r-in"><span><span class="fu">experimentFiles</span><span class="op">(</span><span class="va">mse</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">[[</span><span class="st">"annotations"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "internal_standards.txt" "internal_standards.txt"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Spectra within an MsExperiment can be filtered/subset with the</span></span></span>
<span class="r-in"><span><span class="co">## `filterSpectra` function and any of the filter functions supported</span></span></span>
<span class="r-in"><span><span class="co">## by `Spectra` objects. Below we restrict the spectra data to spectra</span></span></span>
<span class="r-in"><span><span class="co">## with a retention time between 200 and 210 seconds.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">filterSpectra</span><span class="op">(</span><span class="va">mse</span>, <span class="va">filterRt</span>, rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">210</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class MsExperiment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Files: mzML_files, annotations </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Spectra: MS1 (72) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Experiment data: 2 sample(s)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Sample data links:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - experimentFiles.mzML_files: 2 sample(s) to 2 element(s).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - experimentFiles.annotations: 2 sample(s) to 1 element(s).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - spectra: 2 sample(s) to 72 element(s).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The object contains now much less spectra. The retention times for these</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime</a></span><span class="op">(</span><span class="fu">spectra</span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 200.049 200.328 200.607 200.886 201.165 201.444 201.723 202.002 202.281</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10] 202.560 202.839 203.118 203.397 203.676 203.955 204.234 204.513 204.792</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] 205.071 205.350 205.629 205.908 206.187 206.466 206.745 207.024 207.303</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [28] 207.582 207.861 208.140 208.419 208.698 208.977 209.256 209.535 209.814</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [37] 200.044 200.323 200.602 200.881 201.160 201.439 201.718 201.997 202.276</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [46] 202.555 202.834 203.113 203.392 203.671 203.950 204.229 204.508 204.787</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [55] 205.066 205.345 205.624 205.903 206.182 206.461 206.740 207.019 207.298</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [64] 207.577 207.856 208.135 208.414 208.693 208.972 209.251 209.530 209.809</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Relationship between samples and spectra was preserved by the filtering</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span><span class="fl">1L</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu">spectra</span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 36 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1   200.049       717</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1   200.328       718</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1   200.607       719</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           1   200.886       720</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           1   201.165       721</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...       ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32          1   208.698       748</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33          1   208.977       749</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34          1   209.256       750</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35          1   209.535       751</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36          1   209.814       752</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20171016_POOL_POS_1_105-134.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select retention time [200..210] on MS level(s)  [Wed Jun  4 06:39:29 2025] </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer></div>





  </body></html>

